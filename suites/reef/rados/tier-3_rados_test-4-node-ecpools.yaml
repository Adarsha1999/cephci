# Suite is to be used to verify the EC 2+2 config on 4 nodes

tests:

  - test:
      name: Configure email alerts
      module: rados_prep.py
      polarion-id: CEPH-83574472
      config:
        email_alerts:
          smtp_host: smtp.corp.redhat.com
          smtp_sender: ceph-iad2-c01-lab.mgr@redhat.com
          smtp_port: 25
          interval: 10
          smtp_destination:
            - pdhiran@redhat.com
          smtp_from_name: Rados Sanity Cluster Alerts
      desc: Configure email alerts on ceph cluster

  - test:
      name: Enable logging to file
      module: rados_prep.py
      config:
        log_to_file: true
      desc: Change config options to enable logging to file

  - test:
      name: Set configs for 4 node cluster
      desc: Set configs for 4 node cluster
      module: test_cephadm.py
      config:
        steps:
          - config:
              command: shell
              args:
                - ceph
                - config
                - set
                - mon
                - mon_osd_down_out_subtree_limit
                - host
          - config:
              command: shell
              args:
                - ceph
                - config
                - set
                - osd
                - osd_async_recovery_min_cost
                - "1099511627776"

  - test:
      name: EC pool LC
      module: test_four_node_ecpool.py
      polarion-id: CEPH-83575858
      config:
        ec_pool:
          profile_name: ec22_profile
          pool_name: test_ec_pool
          k: 2
          m: 2
          force: true
          plugin: jerasure
          crush-failure-domain: host
        delete_pools:
          - test_ec_pool
      desc: Create, modily & delete EC pools and run IO

  - test:
      name: EC Pool Recovery Improvement
      module: pool_tests.py
      polarion-id: CEPH-83573852
      config:
        ec_pool_recovery_improvement:
          create: true
          pool_name: ec_pool_recovery
          k: 2
          m: 2
          pg_num: 32
          plugin: jerasure
          crush-failure-domain: host
          rados_write_duration: 100
          rados_read_duration: 50
          osd_max_backfills: 16
          osd_recovery_max_active: 16
          delete_pool: true
      desc: Verify Recovery of EC pool with only "k" shards available

  - test:
      name: EC pool LC
      module: rados_prep.py
      polarion-id: CEPH-83571632
      config:
        ec_pool:
          create: true
          pool_name: test_ec_pool
          pg_num: 64
          k: 2
          m: 2
          plugin: jerasure
          crush-failure-domain: host
          disable_pg_autoscale: true
          rados_write_duration: 50
          rados_read_duration: 30
        set_pool_configs:
          pool_name: test_ec_pool
          configurations:
            pg_num: 32
            pgp_num: 32
            pg_autoscale_mode: 'on'
            compression_mode: force
            compression_algorithm: snappy
        delete_pools:
          - test_ec_pool
      desc: Create, modily & delete EC pools and run IO

  - test:
      name: EC pool with Overwrites
      module: rados_prep.py
      polarion-id: CEPH-83571730
      config:
        ec_pool:
          create: true
          pool_name: ec_pool_overwrite
          app_name: rbd
          pg_num: 32
          erasure_code_use_overwrites: "true"
          k: 2
          m: 2
          plugin: jerasure
          crush-failure-domain: host
          rados_write_duration: 50
          rados_read_duration: 30
          test_overwrites_pool: true
          metadata_pool: re_pool_overwrite
          image_name: image_ec_pool
          image_size: 100M
        delete_pools:
          - ec_pool_overwrite
          - re_pool_overwrite
      desc: EC pool with Overwrites & create RBD pool
